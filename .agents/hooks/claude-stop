#!/bin/bash
#
# Stop hook: Collect DevLoop findings when Claude finishes
#
set -e
PROJECT_DIR="${CLAUDE_PROJECT_DIR:-.}"
cd "$PROJECT_DIR" || exit 0
if ! command -v devloop &>/dev/null; then
    exit 0
fi
input_json=$(cat)
stop_hook_active=$(echo "$input_json" | jq -r '.stop_hook_active // false' 2>/dev/null || echo "false")
if [ "$stop_hook_active" = "true" ]; then
    exit 0
fi
devloop amp_findings 2>/dev/null || true
exit 0
